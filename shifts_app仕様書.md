🧾 シフト管理機能 要件定義
🎯 目的

販売員の出勤・休み希望の収集、管理、売り場への割当をWebアプリ上で一元管理し、
人員不足・ドライバー不足・調整コストを削減する。

既存の日報システム（salesアプリ）に増設し、運用負担を軽減する。

🏗 システム構成
新規アプリ

Django app 名：shifts

既存アプリとの連携

売り場：sales.SalesLocation を使用

ユーザー：標準 User（将来拡張を考慮し AUTH_USER_MODEL 経由）

👥 ユーザー種別
一般スタッフ

出勤/休み希望提出

自分の提出状況確認

確定シフト閲覧

管理者（1アカウント）

募集期間設定

代理提出（締切後）

会社カレンダー管理

シフト割当

運転不足確認

🗓 シフト期間
単位

2週間（前半・後半）

📆 募集期間管理（重要）
SchedulePeriod
フィールド

start_date（期間開始）

end_date（期間終了）

submission_open_at（募集開始日時）

submission_close_at（募集締切日時）

status（OPEN / REVIEW / FIXED / PUBLISHED）

⏱ 募集状態と提出権限
状態	本人提出	管理者提出
募集前	❌	❌
募集中	✅	✅
締切後	❌	✅（代理入力）
公開後	❌	❌
📝 希望提出機能
入力内容（2週間分）

各日：

出勤 / 休み

休みの場合：理由カテゴリ

休み理由カテゴリ（四段階）

通常

特例

代理（代替者指定）

冠婚葬祭・緊急

締切後の扱い（B仕様）

本人は提出不可

管理者のみ代理入力可能

代理入力は記録される

追加項目

submitted_by_admin（代理提出フラグ）

is_late_submission（遅刻提出）

🗓 休日判定
対象

以下は自動的に休み扱い：

土曜日

日曜日

日本の祝日（jpholiday）

会社カレンダー（CompanyHoliday）

UI挙動
休日の日

デフォルト：休み

出勤選択不可（MVP）

理由カテゴリ不要

🚗 ドライバー制約
前提

ドライバーは販売員の一部（役割ではなく能力）

スタッフ属性（UserProfile）

can_drive（運転可能）

work_pattern（毎日/固定/不定/助っ人）

uses_app（助っ人判定）

売り場属性（SalesLocation拡張）

requires_drive（運転必須）

priority（S/A/B）

🧠 割当制約
運転必須売り場
requires_drive = True
→ can_drive = True のスタッフのみ割当可能

📊 管理ダッシュボード

日ごとに表示：

開ける売り場数

運転必須売り場数

出勤可能人数

運転可能人数

運転不足警告

🗂 確定シフト
ShiftAssignment

日付

売り場

担当者

状態（仮/確定）

制約：

売り場×日付は一意

休日は割当不可

🏢 会社カレンダー管理
CompanyHoliday

日付

名称

管理者が追加・削除可能

🎨 デザイン
Tailwind CSS

shiftsアプリのみ採用

shifts/templates/shifts/base.html にCDN導入

既存salesテンプレートは変更しない

📱 画面一覧
スタッフ

シフト提出画面

自分の提出状況

確定シフト閲覧

管理者

募集期間設定

会社カレンダー管理

ダッシュボード（不足確認）

日別割当画面

🧪 MVP実装順

モデル追加

募集期間設定

提出フォーム

提出状況表示

管理ダッシュボード

割当機能

確定シフト閲覧






