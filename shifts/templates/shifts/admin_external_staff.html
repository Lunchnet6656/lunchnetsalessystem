{% extends "shifts/base.html" %}
{% block title %}å¤–éƒ¨ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†{% endblock %}
{% block nav_external_staff %}bg-gray-600{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">å¤–éƒ¨ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</h1>

<!-- è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
<div class="bg-white rounded shadow p-4 mb-6">
    <h2 class="text-lg font-semibold mb-3">å¤–éƒ¨ã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ </h2>
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="add">
        <div class="flex flex-wrap gap-3 items-end">
            <div>
                <label class="block text-sm text-gray-600">åå‰ <span class="text-red-500">*</span></label>
                <input type="text" name="name" required placeholder="ä¾‹: ç”°ä¸­å¤ªéƒ" class="border rounded px-3 py-2 text-sm">
            </div>
            <div>
                <label class="block text-sm text-gray-600">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå£²ã‚Šå ´</label>
                <select name="default_location" class="border rounded px-3 py-2 text-sm">
                    <option value="">-- ãªã— --</option>
                    {% for loc in locations %}
                    <option value="{{ loc.id }}">{{ loc.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex items-center pt-5">
                <input type="checkbox" id="new_can_drive" name="can_drive" class="h-4 w-4 text-blue-600 rounded border-gray-300">
                <label for="new_can_drive" class="ml-2 text-sm text-gray-700">é‹è»¢å¯èƒ½</label>
            </div>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700">è¿½åŠ </button>
        </div>
    </form>
</div>

<!-- ä¸€è¦§ -->
<div class="bg-white rounded shadow overflow-hidden">
    <table class="w-full text-sm">
        <thead>
            <tr class="bg-gray-100 text-left">
                <th class="px-4 py-2">åå‰</th>
                <th class="px-4 py-2">é‹è»¢å¯èƒ½</th>
                <th class="px-4 py-2">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå£²ã‚Šå ´</th>
                <th class="px-4 py-2">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th class="px-4 py-2">æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for s in staff_list %}
            <tr class="border-b border-gray-100 {% if not s.is_active %}bg-gray-50 text-gray-400{% endif %}">
                <td class="px-4 py-2">{{ s.name }}</td>
                <td class="px-4 py-2">{% if s.can_drive %}ğŸš— å¯{% else %}-{% endif %}</td>
                <td class="px-4 py-2">{{ s.default_location|default:"-" }}</td>
                <td class="px-4 py-2">
                    {% if s.is_active %}
                    <span class="text-xs px-2 py-1 rounded bg-green-100 text-green-700">æœ‰åŠ¹</span>
                    {% else %}
                    <span class="text-xs px-2 py-1 rounded bg-gray-200 text-gray-500">ç„¡åŠ¹</span>
                    {% endif %}
                </td>
                <td class="px-4 py-2 flex gap-2">
                    <form method="post" class="inline">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="toggle_active">
                        <input type="hidden" name="staff_id" value="{{ s.id }}">
                        <button type="submit" class="text-xs {% if s.is_active %}text-yellow-600{% else %}text-green-600{% endif %} hover:underline">
                            {% if s.is_active %}ç„¡åŠ¹ã«ã™ã‚‹{% else %}æœ‰åŠ¹ã«ã™ã‚‹{% endif %}
                        </button>
                    </form>
                    <form method="post" class="inline" onsubmit="return confirm('{{ s.name }} ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="staff_id" value="{{ s.id }}">
                        <button type="submit" class="text-xs text-red-600 hover:underline">å‰Šé™¤</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="5" class="px-4 py-4 text-gray-400 text-center">å¤–éƒ¨ã‚¹ã‚¿ãƒƒãƒ•ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- å‡ºå‹¤å¯èƒ½æ—¥è¨­å®š -->
{% if periods %}
<div class="bg-white rounded shadow p-4 mt-6">
    <h2 class="text-lg font-semibold mb-3">å‡ºå‹¤å¯èƒ½æ—¥ã‚’è¨­å®š</h2>
    <div class="flex flex-wrap gap-2">
        {% for p in periods %}
        <a href="{% url 'shifts:admin_external_availability' p.id %}"
           class="inline-block border rounded px-3 py-2 text-sm hover:bg-blue-50 hover:border-blue-400">
            {{ p.start_date|date:"n/j" }}ã€œ{{ p.end_date|date:"n/j" }}
            <span class="text-xs px-1 rounded
                {% if p.status == 'OPEN' %}bg-green-100 text-green-700
                {% elif p.status == 'REVIEW' %}bg-yellow-100 text-yellow-700
                {% else %}bg-blue-100 text-blue-700{% endif %}">
                {{ p.get_status_display }}
            </span>
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}
